# JSP 顾客列表页面代码详解（带注释）

## 代码整体结构说明

这段代码是一个 JSP（JavaServer Pages）页面，用于展示顾客列表信息，属于 MVC 架构中的 View 层。JSP 页面结合了 HTML、JSP 指令、EL 表达式和 JSTL 标签，实现了动态数据展示、条件判断、循环遍历等功能。

```jsp
<%-- JSP页面指令：设置页面基本属性 --%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%-- 导入JSTL核心标签库：用于条件判断、循环等逻辑控制 --%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%-- 导入JSTL格式化标签库：用于日期、数字等格式化（本页面未使用，但作为常见导入保留） --%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>

<%-- HTML文档开始 --%>
<html>
<head>
    <title>顧客一覧 - 保険システム</title>
    <%-- 引入外部CSS样式表（假设存在） --%>
    <link rel="stylesheet" type="text/css" href="${pageContext.request.contextPath}/css/style.css">
</head>
<body>
    <div class="container">
        <%-- 页面标题区域 --%>
        <h1>顧客一覧</h1>

        <%-- 导航菜单 --%>
        <nav>
            <ul>
                <li><a href="${pageContext.request.contextPath}/home">ホーム</a></li>
                <li class="active"><a href="${pageContext.request.contextPath}/customer?action=list">顧客管理</a></li>
                <%-- 新增顾客链接：跳转到表单页面 --%>
                <li><a href="${pageContext.request.contextPath}/customer?action=edit">新規登録</a></li>
            </ul>
        </nav>

        <%-- 消息提示区域 --%>
        <div class="messages">
            <%-- 成功消息：如果请求参数中包含message，则显示成功提示框 --%>
            <c:if test="${not empty param.message}">
                <div class="alert alert-success">${param.message}</div>
            </c:if>

            <%-- 错误消息：如果请求参数中包含error，则显示错误提示框 --%>
            <c:if test="${not empty param.error}">
                <div class="alert alert-danger">${param.error}</div>
            </c:if>
        </div>

        <%-- 搜索表单区域 --%>
        <div class="search-form">
            <form action="${pageContext.request.contextPath}/customer" method="get">
                <%-- 隐藏字段：指定action为search，表示执行搜索操作 --%>
                <input type="hidden" name="action" value="search">

                <input type="text" name="keyword"
                       placeholder="検索キーワードを入力"
                       <%-- 回显搜索关键词：如果有搜索关键词，保持在输入框中 --%>
                       value="${not empty searchKeyword ? searchKeyword : ''}">

                <button type="submit" class="btn btn-primary">検索</button>
                <%-- 清除按钮：重置表单并跳转到顾客列表页面 --%>
                <a href="${pageContext.request.contextPath}/customer?action=list" class="btn btn-secondary">クリア</a>
            </form>
        </div>

        <%-- 顾客列表表格 --%>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>顧客コード</th>
                        <th>氏名</th>
                        <th>性別</th>
                        <th>年齢</th>
                        <th>電話番号</th>
                        <th>メール</th>
                        <th>登録日</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    <%-- 循环遍历顾客列表：使用JSTL的c:forEach标签 --%>
                    <%-- items="${customers}"：遍历request作用域中的customers集合 --%>
                    <%-- var="customer"：每次循环将当前元素赋值给customer变量 --%>
                    <c:forEach items="${customers}" var="customer">
                        <tr>
                            <%-- EL表达式：获取customer对象的属性值 --%>
                            <td>${customer.customerCode}</td>
                            <td>${customer.lastName} ${customer.firstName}</td>

                            <%-- 条件判断：根据gender属性显示"男"或"女" --%>
                            <td>
                                <c:choose>
                                    <c:when test="${customer.gender == 'M'}">男</c:when>
                                    <c:when test="${customer.gender == 'F'}">女</c:when>
                                    <c:otherwise>不明</c:otherwise>
                                </c:choose>
                            </td>

                            <td>${customer.age}歳</td>
                            <td>${customer.phoneNumber}</td>
                            <td>${customer.email}</td>
                            <%-- 格式化日期：使用fmt:formatDate标签将Date对象格式化为字符串 --%>
                            <td><fmt:formatDate value="${customer.createdAt}" pattern="yyyy-MM-dd HH:mm"/></td>

                            <%-- 操作按钮列 --%>
                            <td class="action-buttons">
                                <%-- 详情按钮：跳转到查看页面，传递顾客ID --%>
                                <a href="${pageContext.request.contextPath}/customer?action=view&id=${customer.id}" class="btn btn-info">詳細</a>

                                <%-- 编辑按钮：跳转到编辑页面，传递顾客ID --%>
                                <a href="${pageContext.request.contextPath}/customer?action=edit&id=${customer.id}" class="btn btn-warning">編集</a>

                                <%-- 删除按钮：点击后显示确认对话框，确认后跳转到删除操作 --%>
                                <a href="javascript:confirmDelete(${customer.id})" class="btn btn-danger">削除</a>
                            </td>
                        </tr>
                    </c:forEach>

                    <%-- 无数据情况处理 --%>
                    <%-- 如果customers集合为空 --%>
                    <c:if test="${empty customers}">
                        <tr>
                            <%-- 合并所有列 --%>
                            <td colspan="8" class="text-center">
                                <%-- 根据是否有搜索关键词显示不同提示信息 --%>
                                <c:choose>
                                    <c:when test="${not empty searchKeyword}">
                                        検索条件に一致する顧客が見つかりませんでした
                                    </c:when>
                                    <c:otherwise>
                                        顧客データがありません
                                    </c:otherwise>
                                </c:choose>
                            </td>
                        </tr>
                    </c:if>
                </tbody>
            </table>
        </div>

        <%-- 页脚区域 --%>
        <footer>
            <p>&copy; 2024 保険システム</p>
        </footer>
    </div>

    <%-- JavaScript代码区域 --%>
    <script type="text/javascript">
        <%-- 删除确认函数 --%>
        function confirmDelete(id) {
            <%-- 显示确认对话框，如果用户点击确定，则跳转到删除URL --%>
            if (confirm('本当に削除しますか？')) {
                window.location.href = '${pageContext.request.contextPath}/customer?action=delete&id=' + id;
            }
        }

        <%-- 自动关闭提示框 --%>
        setTimeout(function() {
            <%-- 获取所有class为alert的元素 --%>
            var alerts = document.querySelectorAll('.alert');
            <%-- 遍历所有提示框，设置为隐藏 --%>
            alerts.forEach(function(alert) {
                alert.style.display = 'none';
            });
        }, 5000); <%-- 5000毫秒（5秒）后执行 --%>
    </script>
</body>
</html>
```

## 核心知识点总结

### 1. JSP 基本语法

- **JSP 指令**：以`<%@`开头，用于设置页面属性和导入资源
  - `page`指令：设置 contentType（内容类型和编码）、language（脚本语言）等
  - `taglib`指令：导入标签库，如 JSTL 标签库
- **EL 表达式**：`${表达式}`，用于获取和输出数据，简化 Java 代码
  - 获取请求参数：`${param.message}`
  - 获取请求属性：`${customer.lastName}`
  - 条件判断：`${not empty searchKeyword ? searchKeyword : ''}`（三元运算符）
- **JSTL 标签**：JavaServer Pages Standard Tag Library，提供常用逻辑控制功能
  - 核心标签库：`prefix="c"`，包含条件判断（`c:if`、`c:choose`）、循环（`c:forEach`）等
  - 格式化标签库：`prefix="fmt"`，用于日期、数字格式化（`fmt:formatDate`）

### 2. 数据流转与绑定

- **后端到前端**：Servlet 将数据存入 request 作用域（如`request.setAttribute("customers", customers)`），JSP 通过 EL 表达式`${customers}`获取数据
- **前端到后端**：通过表单提交或 URL 参数传递数据（如搜索关键词、顾客 ID）
- **数据回显**：在搜索框中使用`${not empty searchKeyword ? searchKeyword : ''}`保持用户输入的搜索关键词

### 3. 条件判断与循环

- **条件判断**：
  - `c:if`：简单条件判断（如显示消息提示、无数据提示）
  - `c:choose` + `c:when` + `c:otherwise`：多条件判断（如性别显示、无数据提示文本）
- **循环遍历**：`c:forEach`用于遍历集合数据（如顾客列表），`items`指定集合，`var`指定循环变量

### 4. JSP 与 Servlet 的交互

- **请求流程**：
  1. 用户访问 Servlet（如 CustomerServlet?action=list）
  2. Servlet 处理业务逻辑，查询数据并存入 request 作用域
  3. Servlet 转发请求到 JSP 页面
  4. JSP 页面渲染数据并生成 HTML 响应
- **URL 构建**：使用`${pageContext.request.contextPath}`获取应用上下文路径，确保 URL 的正确性

### 5. 前端交互与 JavaScript

- **删除确认**：自定义`confirmDelete`函数，使用`confirm`对话框获取用户确认
- **自动关闭提示框**：使用`setTimeout`定时执行函数，5 秒后隐藏所有提示框
- **动态效果**：通过 CSS 类和 JavaScript 实现页面交互效果

### 6. View 层在 MVC 架构中的作用

- **职责**：负责数据展示和用户界面，不包含业务逻辑
- **与 Controller 交互**：接收 Controller 传递的数据，渲染为 HTML 页面
- **与用户交互**：提供表单输入、按钮点击等用户操作接口，将用户请求发送给 Controller

### 7. 国际化与本地化

- **页面语言**：页面使用日语，展示了国际化应用的基本实现
- **日期格式**：使用`fmt:formatDate`指定日期格式为`yyyy-MM-dd HH:mm`，符合日本日期显示习惯

### 8. 最佳实践

- **代码分离**：HTML 结构、CSS 样式、JavaScript 代码分离，提高可维护性
- **用户体验**：提供操作反馈（消息提示）、确认对话框（删除操作）、自动关闭提示框
- **安全考虑**：删除操作需要用户确认，防止误操作
- **可访问性**：使用语义化 HTML 标签、适当的 CSS 类和响应式设计

# Java 数据库连接工具类代码详解（带注释）

## 代码整体结构说明

这段代码是数据库连接管理的工具类，负责创建和关闭数据库连接，封装了 JDBC 连接的细节。对于初学者来说，理解数据库连接的建立过程、驱动加载机制和资源管理是掌握 JDBC 编程的基础。

```java
// 包声明：指定该工具类所属的包
package com.insurance.util;

// 导入JDBC相关类：用于数据库连接和异常处理
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.util.Properties;

/**
 * 数据库连接工具类
 * 封装了数据库连接的创建和关闭操作，提供静态方法供其他类使用
 * 采用工具类设计模式：所有方法都是静态的，无需创建对象即可使用
 */
public class DatabaseUtil {
    // 数据库连接URL：指定数据库类型、地址、端口和数据库名
    // jdbc:mysql://主机名:端口号/数据库名
    private static final String DB_URL = "jdbc:mysql://localhost:3306/insurance_system";

    // 数据库用户名
    private static final String DB_USER = "root";

    // 数据库密码
    private static final String DB_PASSWORD = "password";

    // 静态代码块：在类加载时执行，用于加载JDBC驱动
    static {
        try {
            // 加载MySQL JDBC驱动类
            // "com.mysql.jdbc.Driver"是MySQL JDBC驱动的类名
            Class.forName("com.mysql.jdbc.Driver");
        } catch (ClassNotFoundException e) {
            // 如果驱动类未找到，抛出运行时异常，程序终止
            throw new RuntimeException("MySQL JDBC Driver not found", e);
        }
    }

    /**
     * 获取数据库连接
     * @return 数据库连接对象(Connection)
     * @throws SQLException 如果获取连接失败，抛出SQL异常
     */
    public static Connection getConnection() throws SQLException {
        // 创建Properties对象，用于设置连接属性
        Properties props = new Properties();

        // 设置连接属性
        props.setProperty("user", DB_USER);          // 用户名
        props.setProperty("password", DB_PASSWORD);  // 密码
        props.setProperty("useSSL", "false");        // 不使用SSL连接
        props.setProperty("characterEncoding", "UTF-8"); // 使用UTF-8字符编码
        props.setProperty("useUnicode", "true");     // 使用Unicode字符集
        props.setProperty("serverTimezone", "Asia/Tokyo"); // 设置时区为东京时间

        // 通过DriverManager获取数据库连接
        // 参数1：连接URL，参数2：连接属性
        return DriverManager.getConnection(DB_URL, props);
    }

    /**
     * 关闭数据库连接
     * 安全关闭连接，避免资源泄漏
     * @param conn 要关闭的数据库连接对象，可以为null（为null时不执行操作）
     */
    public static void closeConnection(Connection conn) {
        // 检查连接对象是否不为null
        if (conn != null) {
            try {
                // 关闭连接
                conn.close();
            } catch (SQLException e) {
                // 打印关闭连接失败的错误信息
                System.err.println("Failed to close database connection: " + e.getMessage());
            }
        }
    }
}
```

## 核心知识点总结

### 1. 工具类设计模式

- **静态方法**：所有方法都使用`static`修饰，可以直接通过类名调用（如`DatabaseUtil.getConnection()`）
- **私有构造方法**：虽然代码中没有显式定义，但工具类通常会私有化构造方法，防止创建对象
- **无状态**：工具类不保存任何实例状态，所有属性都是静态的，方法只依赖输入参数和静态属性

### 2. 静态代码块与类加载

- **执行时机**：静态代码块在类被加载到 JVM 时执行，且只执行一次
- **驱动加载**：`Class.forName("com.mysql.jdbc.Driver")`的作用是加载并初始化 MySQL 驱动类
- **驱动注册**：驱动类在初始化时会自动向`DriverManager`注册自己，这是 JDBC 规范的要求

### 3. 数据库连接 URL 详解

- **组成结构**：`jdbc:mysql://主机名:端口号/数据库名`
  - `jdbc:mysql`：表示使用 MySQL 的 JDBC 驱动
  - `localhost`：数据库服务器地址（本地主机）
  - `3306`：MySQL 默认端口号
  - `insurance_system`：要连接的数据库名

### 4. 连接属性配置

- **基本认证**：`user`和`password`用于数据库身份验证
- **字符编码**：`characterEncoding=UTF-8`和`useUnicode=true`确保中文正常显示
- **时区设置**：`serverTimezone=Asia/Tokyo`解决时区不一致导致的时间问题
- **SSL 设置**：`useSSL=false`在开发环境中禁用 SSL 连接（生产环境建议启用）

### 5. 连接管理最佳实践

- **获取连接**：通过`DriverManager.getConnection()`方法获取连接，返回的`Connection`对象代表与数据库的会话
- **关闭连接**：使用`closeConnection()`方法确保连接被正确关闭，避免资源泄漏
- **异常处理**：获取连接时抛出`SQLException`，由调用者处理；关闭连接时捕获异常并打印错误信息

### 6. JDBC 编程基本流程

1. **加载驱动**：通过静态代码块加载数据库驱动
2. **获取连接**：调用`getConnection()`方法建立与数据库的连接
3. **执行 SQL**：使用`Connection`创建`Statement`或`PreparedStatement`执行 SQL 语句
4. **处理结果**：对于查询操作，处理返回的`ResultSet`结果集
5. **释放资源**：调用`closeConnection()`关闭连接，释放资源

### 7. 异常处理策略

- **驱动加载失败**：在静态代码块中抛出`RuntimeException`，因为没有驱动程序无法进行数据库操作
- **获取连接异常**：`getConnection()`方法声明抛出`SQLException`，由调用者决定如何处理（如重试或提示用户）
- **关闭连接异常**：捕获异常并打印错误信息，但不中断程序执行，因为连接关闭失败通常不影响主流程
